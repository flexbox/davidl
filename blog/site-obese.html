<!DOCTYPE html><html lang=fr><head prefix="og: http://ogp.me/ns# dc: http://purl.org/dc/terms/"><meta charset=utf-8 /><meta content="width=device-width,initial-scale=1" name=viewport /><title>Performance site internet : Astuces et bonnes pratiques</title><meta content="" name=description /><meta content="index,follow" name=robots /><meta content="David Leuliette" property="dc:creator"/><meta content="text/html" property="dc:format"/><meta content=fr-FR property="dc:language"/><meta content="davidl • design & développement" property="og:site_name"/><meta content=website property="og:type"/><meta content="http://davidl.fr" property="og:url"/><meta content="Performance site internet : Astuces et bonnes pratiques" property="og:title"/><meta content="Je crée des sites internet qui fonctionnent à merveille sur n’importe quel appareil. Designer spécialisé HTML et CSS basé à Lille" property="og:description"/><meta content="" property="og:image"/><meta content="50.629250;3.057256" name="geo.position"/><meta content="Lille, Nord" name="geo.placename"/><meta content=FR-59 name="geo.region"/><meta content="@_flexbox" name="twitter:site"/><meta content="Performance site internet : Astuces et bonnes pratiques" name="twitter:title"/><meta content="Je crée des sites internet qui fonctionnent à merveille sur n’importe quel appareil. Designer spécialisé HTML et CSS basé à Lille" name="twitter:description"/><meta content=summary name="twitter:card"/><meta content="" name="twitter:image"/><meta content="Performance site internet : Astuces et bonnes pratiques" itemprop=name /><meta content="Je crée des sites internet qui fonctionnent à merveille sur n’importe quel appareil. Designer spécialisé HTML et CSS basé à Lille" itemprop=description /><meta content="" itemprop=image /><link href="https://plus.google.com/+DavidLeulietteWeb" rel=publisher /><link href="/feed.xml" rel=alternate title="davidl • design & développement" type="application/rss+xml"/><meta content=yes name=mobile-web-app-capable /><meta content="davidl • design & développement" name=application-name /><link href="/chrome-touch-icon-192x192.png" rel=icon sizes=192x192 /><meta content=yes name=apple-mobile-web-app-capable /><meta content=black name=apple-mobile-web-app-status-bar-style /><meta content="davidl • design & développement" name=apple-mobile-web-app-title /><link href="/apple-touch-icon.png" rel=apple-touch-icon /><meta content="ms-touch-icon-144x144-precomposed.png" name=msapplication-TileImage /><meta content="#607D8B" name=msapplication-TileColor /><meta content="#607D8B" name=theme-color /><link href="/favicon-196x196.png" rel=icon sizes=196x196 type="image/png"/><link href="/favicon-160x160.png" rel=icon sizes=160x160 type="image/png"/><link href="/favicon-96x96.png" rel=icon sizes=96x96 type="image/png"/><link href="/favicon-32x32.png" rel=icon sizes=32x32 type="image/png"/><link href="/favicon-16x16.png" rel=icon sizes=16x16 type="image/png"/><link href="../assets/stylesheets/application-5ef0ccc5.css" rel=stylesheet /><link href="https://netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel=stylesheet /></head><body class=" blog blog_site-obese"><header class=m-topbar id=js-topbar role=banner><nav aria-label=Primary class="m-topbar--list js-topbar--list is-away" role=navigation><a class=m-topbar--logo title="Retour à l’accueil" href="/"><img alt="davidl intégrateur web &amp; développeur front-end lille" src="../assets/images/atom-logo-4a5eee23.svg"/></a><a href="/consulting/">Consulting</a><a href="/about.html">À propos</a><a href="/blog/">Blog</a><a href="/contact.html">Contact</a></nav><div class=m-topbar--form id=js-topbar--form><a id=js-topbar--button class=l-menu href="#"><span>Menu</span></a><form action="http://www.google.com/search" class="l-search-form is-hidden" method=get><input id=js-search-input name=q placeholder="Ex : Conseils et bonnes pratiques" type=search /><input name=sitesearch type=hidden value="http://davidl.fr"/></form><a id=js-topbar--search class=l-action href="#"><i class="fa fa-search"></i></a><a id=js-topbar--close class="l-action is-hidden" href="#"><i class="fa fa-close"></i></a></div></header><div class=m-content role=main><header class=m-hero-banner><div class=row><h1 class=l-title>Votre site web est obèse</h1></div></header><div class=row><div class="medium-12 columns"><div class="m-panel l-blog-date"><i class="fa fa-calendar i-custom fa-lg"></i><time datetime=2014-05-21 pubdate="">21/05/2014</time></div></div></div><article class=row itemscope="" itemtype="http://schema.org/BlogPosting" role=article><div class="medium-8 medium-centered columns m-blog--article" itemprop=articleBody><p>Certains d’entre vous ont sûrement connu l'époque du 56k. En ce temps là, charger une seule image sur internet pouvait demander plusieurs minutes. Puis est arrivé l’ADSL et le haut débit qui ont démultiplié la vitesse de chargement. Bizarrement j’ai l’impression que nous passons toujours autant de temps à attendre le chargement d’une page web.</p> <p><img alt="Site internet obèse" src="https://farm6.staticflickr.com/5519/14256724243_9a829c4dd1_o.jpg"/></p> <p>De nos jours les sites sont de plus en plus complexes, embarquent de plus en plus de contenu. Grâce à la fibre optique ces derniers se chargent de plus en plus vite… En théorie car paradoxalement le web évolue vite, mais les sites web sont toujours aussi long à charger.</p> <p>Il existe beaucoup d’options pour améliorer la performance de votre site internet. Pour vous aider à décider comment mettre en place ces solutions j’ai découpé cet article en 3 parties :</p> <ul> <li>Geek</li> <li>Hacker</li> <li>Guru</li> </ul> <p>Chaque technique peut être déployée partiellement, en partie ou pas du tout. Chaque palier peut vous aider lors du développement de votre site suivant son niveau de complexité.</p> <h2 id=geek-de-la-performance>Geek de la performance</h2> <p>Les 2 choses les plus simples à mettre en place rapidement sont la compression des fichiers et les en-têtes de cache. Ces techniques indispensables vous aiderons à :</p> <ul> <li>Réduire le poids des pages.</li> <li>Réduire le nombre de requêtes http, et donc la latence.</li> </ul> <p>Puisque ces modifications ont lieu côté serveur, elles amélioreront immédiatement les performances de chaque page.</p> <h3 id=activer-moddeflate-pour-la-compression-gzip-de-vos-fichiers>Activer <code>mod_deflate</code> pour la compression <code>Gzip</code> de vos fichiers</h3> <p>De la même manière que nous zippons nos pièces jointes envoyées par email, votre serveur peut compresser les fichiers avant de les envoyer au navigateur. Pour <strong>préserver la bande passante</strong> de vos utilisateurs mobiles, il est capital de réduire le plus possible la taille de votre site.</p> <p>La librairie de compression pour Apache <code>mod_deflate</code> fonctionne uniquement sur des fichiers textes comme <code>HTML</code>, <code>CSS</code> et <code>JavaScript</code>. Les images <code>.jpg</code>, <code>.gif</code> ou <code>.png</code> sont compressées à différents niveaux, comme expliqué plus loin dans cet article, cette librairie n’ont donc aucun effet sur elles.</p> <p>La mise en place demande 3 étapes :</p> <ol> <li>Aller sur le projet <a href="https://github.com/h5bp/html5-boilerplate/blob/master/dist/.htaccess#L499">GitHub HTML5Boilerplate</a>.</li> <li>Copier le contenu <code>mod_deflate</code> du fichier <code>.htaccess</code>,</li> <li>et le coller sur votre serveur.</li> </ol> <h3 id=mettre-les-ressources-en-cache>Mettre les ressources en cache</h3> <p>Si votre site est correctement architecturé, les mises à jours des ressources <code>CSS</code>, <code>JavaScript</code> et images sont moins fréquentes que le contenu. Dans un contexte mobile nous pouvons télécharger ces ressources statiques en une seule fois, et les mettre en cache sur l’appareil.</p> <ul> <li>Moins de requêtes http seront effectuées.</li> <li>Le contenu total à télécharger est diminué.</li> </ul> <p>De cette façon, pour les futures visites, l’expérience de navigation sera incroyablement plus rapide et donc meilleure. L’astuce consiste à utiliser les entêtes d’expiration avec une date adaptée.</p> <p>Il n’est pas conseillé de spécifier une durée inférieure à 1 mois et supérieure à un an. Si vous changez régulièrement une ressource vous pouvez :</p> <ul> <li>Spécifier et identifier cette ressource dans votre fichier <code>.htaccess</code>.</li> <li>Modifier le nom du fichier, qui est une bien meilleure solution car cela donnera naissance à une nouvelle requête http.</li> </ul> <p>La mise en place demande 3 étapes :</p> <ol> <li>Aller sur le projet <a href="https://github.com/h5bp/html5-boilerplate/blob/master/dist/.htaccess#L563">GitHub HTML5Boilerplate</a>.</li> <li>Copier le fichier <code>.htaccess</code>, pour la partie <code>mod_expires</code>,</li> <li>et le coller sur votre serveur.</li> </ol> <p>La plus grande limite de cette technique est la taille du cache des appareils mobiles. Un site web simple doit peser en moyenne 2Mo, le cache des appareils Android 2.x est limité à 6Mo, les appareils iOS sont plus avantagés avec un cache de 50Mo.</p> <p>Pour contourner ce problème nous pouvons mettre en place une fonctionnalité en utilisant l’API HTML5 <code>localStorage</code> mais pour cela il faut être guru de la performance.</p> <h2 id=hacker-de-la-performance>Hacker de la performance</h2> <p>La compression et la mise en cache des fichiers sont de bonnes pratiques mais ce n’est que la base. Pour avoir un <strong>réel impact sur la performance</strong> et offrir une expérience optimisée à vos utilisateurs vous allez devoir travailler plus. Les techniques de cette partie permettent de :</p> <ul> <li>Réduire le poids de vos pages.</li> <li>Réduire le nombre de requêtes à votre serveur, et donc la latence.</li> <li>Afficher du contenu à la demande.</li> </ul> <p>Les techniques de minification et de concaténation devraient êtres mises en places lors de déploiement dans des environnements de test / production. Elles ne sont pas vraiment utiles si vos mises à jours sont fréquentes et multiples.</p> <h3 id=mettre-vos-fichiers-au-rgime>Mettre vos fichiers au régime.</h3> <p>Minifier votre code source signifie simplement supprimer les octets inutiles d’un fichier (espaces, indentation et saut de ligne). Cette syntaxe est indispensable pour qu’un humain comprenne, mais elle n’est pas nécessaire pour l'éxécution du code sur une machine.</p> <blockquote> <p>Le code source est écrit pour les humains, pas pour les machines</p> <p><cite>@drublic</cite></p> </blockquote> <p>Avec la minification le navigateur télécharge moins de contenu, le rendu de votre page est donc plus rapide.</p> <p>Si vous utilisez une librairie populaire comme jQuery vous utilisez certainement la version <code>.min</code>. La minification n’est pas seulement disponible pour le JavaScript, mais peut être appliquée à n’importe quelle type de ressource texte. L'<code>asset</code> principale qui doit être minifiée dans un code de production est le CSS. La plus vieille solution pour réaliser cette opération est <a href="http://yui.github.io/yuicompressor/">YUI Compressor</a> de yahoo! Si vous êtes un <a href="http://davidl.fr/manifesto.html">développeur front-end éclairé</a> essayez de chercher du côté des tâches grunt pour automatiser cette opération.</p> <h3 id=la-concatnation--un-fichier-pour-les-gouverner-tous>La concaténation : un fichier pour les gouverner tous</h3> <p>Si le père de la performance est la minification, la concaténation des fichiers est sans doute la mère. Par exemple : au lieu de télécharger 10 fichiers JavaScripts qui demandent 10 requêtes http au serveur, les utilisateurs devraient télécharger seulement 4 fichiers qui représentent la combinaison de ces 10 fichiers.</p> <p>Après les <code>mod_expires</code>, la concaténation est la meilleure option à mettre en place pour fluidifier la navigation sur mobile. Malheureusement la pratique est plus complexe que la théorie.</p> <p>En moyenne un navigateur peut télécharger 6 fichiers en parallèle. Comme la minification YUI est un bon outil pour concaténer vos fichiers. Dans un environement ruby c’est l'<code>asset pipeline</code> qui se charge du boulot, en php c’est <a href="https://github.com/filamentgroup/quickconcat">quickconcat</a>. Vous pouvez aussi <a href="http://blog.carbonfive.com/2014/05/05/roll-your-own-asset-pipeline-with-gulp/">construire votre propre asset pipeline avec gulp</a></p> <h3 id=optimisation-des-images>Optimisation des images</h3> <p>Les images sont les éléments qui prennent le plus de place. En moyenne, c’est plus de 60% dans le poids d’une page. C’est à chacun, développeur comme designer, d’optimiser le poids des images. Le processus se fait en plusieurs étapes :</p> <h4 id=choisir-le-format-adapt>1. Choisir le format adapté</h4> <p><code>.png</code> pour les aplats de couleurs, <code>.jpg</code> pour les photographies. N’enregistrez <strong>jamais</strong> vos images dans la qualité la plus haute mais essayez de trouver le bon compromis entre qualité / poids.</p> <p><img alt="Enregistrement .jpg progressif avec Photoshop" src="https://farm3.staticflickr.com/2901/14256724273_85583d2db6_o.png"/></p> <p><em>Avec Photoshop <code>fichier</code> &gt; <code>enregistrer pour le web</code></em></p> <p>N’oubliez pas de cocher la case <strong>jpg progressif</strong>, cette technique utilisée pour les débits lents à l'époque du 56k prends tout son sens aujourd’hui dans un <a href="http://calendar.perfplanet.com/2012/progressive-jpegs-a-new-best-practice/">contexte de navigation mobile</a>.</p> <h4 id=supprimer-les-informations-inutiles>2. Supprimer les informations inutiles</h4> <p>Pour gagner quelques octets supplémentaires il est possible de supprimer d’autres informations encapsulées dans les images (métadonnées, informations de claques, …) Cette opération peut se faire très facilement avec des logiciels comme :</p> <ul> <li><a href="http://imageoptim.com/">imgOptim</a> pour macOS</li> <li><a href="http://pnggauntlet.com/">pngGauntlet</a> pour windows</li> </ul> <p>Si vous souhaitez en savoir plus sur l’optimisation des images, je vous invite chaudement à lire les articles de Serguey Chikuyonok’s sur l’optimisation intelligente des images <code>.png</code> et <code>.jpg</code></p> <ul> <li><a href="http://www.smashingmagazine.com/2009/07/15/clever-png-optimization-techniques/">Optimiser ses images png</a></li> <li><a href="http://www.smashingmagazine.com/2009/07/01/clever-jpeg-optimization-techniques/">Optimiser ses fichiers jpg</a></li> </ul> <h4 id=automatiser-la-tche>3. Automatiser la tâche</h4> <p>Avec la puissance de node et <a href="https://github.com/JamieMason/ImageOptim-CLI">ImageOptim-CLI</a> il est possible d’automatiser tout ce processus pour vous permettre de gagner un temps considérable.</p> <pre class="highlight plaintext"><code>npm install -g imageoptim-cli
</code></pre> <h4 id=lazy-loading-dimages>4. Lazy Loading d’images</h4> <p>Comme me l’a fait remarqué <a href="https://twitter.com/gaelmetais">@gaelmetais</a>, expert en performance web, la solution qui donne les meilleurs résultats est le lazy loading d’images. Cette solution <a href="https://github.com/vvo/lazyload">JavaScript disponible sur github</a> permet de ne charger que les images visible du <code>viewport</code>. Cela évite de télécharger inutilement des images qui ne sont probablement jamais vues par les visiteurs.</p> <h3 id=reporter-le-chargement-du-contenu>Reporter le chargement du contenu</h3> <p>Toutes les techniques précédentes, ormis la concaténation, vous aiderons à réduire la taille de vos pages. Une autre approche est de prioriser le chargement de votre contenu.</p> <p>La performance n’augmentera pas, c’est le sentiment de vitesse que ressentira l’utilisateur qui doit être perceptible. Le moyen le plus simple de retarder le chargement d’un fichier JavaScript en utilisant l’attribut HTML5 <code>defer</code> ou <code>async</code>.</p> <pre class="highlight html"><code>    <span class="nt">&lt;script </span><span class="na">defer</span> <span class="na">src=</span><span class="s">"application.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">async</span> <span class="na">src=</span><span class="s">"application.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre> <p>D’un point de vue latence et performance ces attributs se comportent de façon similaire. Ils demandent au navigateur d'éxécuter les scripts seulement après avoir téléchargé l’intégralité du contenu de la page.</p> <p>Vous devez vous poser la question : quel priorité dois-je utiliser ?</p> <h4 id=defer-charge-les-scripts-dans-lordre-dappel><code>defer</code> charge les scripts dans l’ordre d’appel</h4> <p>Supposons que vous chargez la librairie jQuery ainsi qu’un autre fichier de plug-in. Ces 2 fichiers sont dépendant car le second script doit être chargé <em>après</em> le premier.</p> <h4 id=async-le-chargement-de-lordre-des-fichiers-na-aucune-importance><code>async</code> le chargement de l’ordre des fichiers n’a aucune importance</h4> <h2 id=guru-de-la-performance>Guru de la performance</h2> <p>Les geeks et les hackers de la performance utilisent des techniques d’optimisation traditionnelles pour la construction de sites internet, bien avant l’apparition du responsive design.</p> <p>Les techniques de guru peuvent êtres mises en place pour des applications web HTML5 avec un focus pour les navigateurs mobiles. Elles permettent de :</p> <ul> <li>Réduire le poids de vos pages.</li> <li>Réduire le nombre de requêtes http, et donc la latence.</li> <li>Optimiser le chargement du contenu pour être utilisé plus rapidement.</li> </ul> <div class="alert-box alert"> Le principal désavantage est le support des navigateurs </div> <p>Dans certains cas il ne sera pas possible de garantir le résultat sur de vieux navigateurs. N’hésitez pas à vérifier les différentes fonctionnalités sur le site <a href="http://caniuse.com">caniuse</a>.</p> <h3 id=ordre-des-sources>Ordre des sources</h3> <p>Curieusement organiser correctement votre CSS et vos fichiers JavaScript peut avoir un large impact sur le ressenti de la rapidité de chargement.</p> <blockquote> <p>JavaScript bloque le chargement de votre contenu</p> <p><cite><a href="/manifesto.html">Manifeste d’un développeur front-end</a></cite></p> </blockquote> <p>Voici un très mauvais exemple que je rencontre quotidiennement :</p> <pre class="highlight html"><code>    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"jquery.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"small.css"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"big.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    ...
</code></pre> <p>Vous ne devez <strong>JAMAIS</strong> faire cela. Le JavaScript bloque téléchargement des autres ressources en parallèle comme les images. Sauf exception votre JavaScript doit toujours être appelé uniquement avant la fin du <code>&lt;/body&gt;</code></p> <h3 id=localstorage-comme-cache-navigateur><code>localStorage</code> comme cache navigateur</h3> <p><code>localStorage</code> est une spécification du W3C. Cette technologie est comparable aux cookies utilisés par les développeurs pour stocker des informations de type clef / valeur. Elles sont sauvegardées même si le navigateur est fermé. Contrairement aux cookies les informations associées au <code>localStorage</code> ne sont jamais renvoyées au serveur depuis le client.</p> <p>Voici un exemple assez basique : utiliser <code>localStorage</code> pour mettre en cache jQuery</p> <pre class="highlight html"><code>    <span class="nt">&lt;--</span> <span class="na">Script</span> <span class="na">tag</span> <span class="na">that</span> <span class="na">will</span> <span class="na">hold</span> <span class="na">jQuery</span> <span class="na">--</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"js-jquery"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;--</span> <span class="na">Determine</span> <span class="na">if</span> <span class="na">jQuery</span> <span class="na">should</span> <span class="na">be</span> <span class="na">loaded</span> <span class="na">from</span> <span class="na">localStorage</span> <span class="na">or</span> <span class="na">the</span> <span class="na">server</span> <span class="na">--</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">jqFile</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="s1">'jqFile'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 1. The script is already stored</span>
        <span class="nx">jqFile</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">getItem</span><span class="p">(</span><span class="s1">'jqFile'</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// 2. not present, AJAX request to get the data</span>
        <span class="nx">jqFile</span> <span class="o">=</span> <span class="nx">getJQFile</span><span class="p">();</span>
        <span class="c1">// push the data into localStorage</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">localStorage</span><span class="p">.</span><span class="nx">setItem</span><span class="p">(</span><span class="s1">'jqFile'</span><span class="p">,</span><span class="nx">jqFile</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// 3. Insert JavaScript into the script element</span>
      <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'js-jquery'</span><span class="p">).</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">jqFile</span><span class="p">;</span>
    <span class="nt">&lt;/script&gt;</span>
</code></pre> <ol> <li>Vérifier si le fichier existe</li> <li>Charger le contenu en AJAX</li> <li>Insérer le contenu dans la page avec <code>js-jquery</code></li> </ol> <p>Il faut noter que <code>localStorage</code> ne fonctionne qu’avec des <code>string</code>. Si vous souhaiter utiliser cette méthode pour stocker des images, vous devez les parser en base64 d’abord.</p> <p><code>localStorage</code> est une solution assez facile à mettre en place pour des choses basiques. Si vous souhaitez aller plus loin je vous conseille d’essayer <a href="https://github.com/addyosmani/basket.js">basket.js</a> maintenu par Addy Osmani qui permet de prioriser le chargement du JavaScript en cache.</p> <h3 id=lazy-loading-javascript>Lazy loading JavaScript</h3> <p>Si votre application web / site internet embarque beaucoups de JavaScript il peut être intéressant de d’utiliser des techniques de <em>lazy loading</em> pour réduire le temps de démarrage.</p> <p>Quand un navigateur télécharge du JavaScript, il le <strong>parcours et l’exécute</strong>. Comme expliqué précédemment, cela bloque le rendu de la page jusqu'à ce que le processus soit terminé. Dans la plupart des cas, vous n’avez sûrement pas besoin que tout votre JavaScript soit parcouru et exécuté au chargement de la page. Cela porte préjudice à la performance sans raison valable.</p> <p>Il existe 2 techniques pour corriger le problème :</p> <ol> <li>Modifier le script précédemment utilisé pour <code>localStorage</code> en utilisant JavaScript pour insérer du JavaScript.</li> <li>Utiliser <code>XmlHttpRequest</code> pour <strong>télécharger et évaluer</strong> le code. Le principal problème est que si l’utilisateur essaye d’utiliser une fonctionnalité qui n’est pas encore téléchargé cela risque de "casser" la mise en page.</li> </ol> <p>L'équipe qui s’occupe de Gmail a trouvé une solution pour que le code ne soit pas exécuté : <a href="http://googlecode.blogspot.de/2009/09/gmail-for-mobile-html5-series-reducing.html">commenter le code</a>.</p> <p>Le navigateur télécharge et évalue l’intégralité de votre JavaScript, mais comme ce dernier est commenté, il n’est pas exécuté. Cette méthode libère du CPU pour effectuer d’autres opérations. Quand l’utilisateur a besoin d’une fonctionnalité, une partie du code est décommentée et évaluée. Voici un exemple :</p> <pre class="highlight html"><code>    <span class="nt">&lt;html&gt;</span>
    ...
    <span class="nt">&lt;script </span><span class="na">id=</span><span class="s">"js-module-lazy"</span><span class="nt">&gt;</span>
    <span class="cm">/*
      JavaScript commented code
    */</span>
    <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;script&gt;</span>
      <span class="kd">function</span> <span class="nx">lazyLoad</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">lazyElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'js-module-lazy'</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">lazyElementContent</span> <span class="o">=</span> <span class="nx">lazyElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">jsCode</span> <span class="o">=</span> <span class="nx">stripOutCommentBlock</span><span class="p">(</span><span class="nx">lazyElementContent</span><span class="p">);</span>
        <span class="nb">eval</span><span class="p">(</span><span class="nx">jsCode</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="nt">&lt;/script&gt;</span>

    <span class="nt">&lt;button</span> <span class="na">onclick=</span><span class="s">"lazyLoad()"</span><span class="nt">&gt;</span>Lazy load feature<span class="nt">&lt;/button&gt;</span>

    <span class="nt">&lt;/html&gt;</span>
</code></pre> <p>Cette technique est complexe à mettre en place car votre architecture JavaScript doit être irréprochable.</p> <h3 id=le-cas-des-boutons-sociaux>Le cas des boutons sociaux</h3> <p>Fin 2011, le magazine Allemand Heise a publié un nouvel ensemble d'<a href="http://www.heise.de/extras/socialshareprivacy/">icônes pour les réseau sociaux</a> très connu. La différence ? Il faut 2 clics pour "aimer", "tweeter" ou ajouter "+1".</p> <p>De base les images des icones sont chargées. Si l’utilisateur souhaite partager, alors les widgets de partage sont téléchargés. Cette solution présente de nombreux avantages non négligeables.</p> <ol> <li>Les utilisateurs ne sont pas constamment trackés. Les widgets ne sont activés que si l’utilisateur le demande et non par défaut.</li> <li>Extrèmement efficace avec du responsive design.</li> </ol> <p><img alt="Image zurb webcitation" src="https://farm3.staticflickr.com/2898/14050189350_521f32f74f_o.png"/> <em><a href="http://zurb.com/article/883/small-painful-buttons-why-social-media-bu">Pourquoi les boutons sociaux tuent votre site web ?</a></em></p> <p>De plus vous ne téléchargez que ce qui est nécessaire. Si un utilisateur n’est actif que sur twitter, l’obliger à télécharger le widget facebook n’a pas de sens, et cela lui évite un temps de latence en supprimant les requêtes http inutiles.</p> <h3 id=utiliser-des-sprites-pour-concatner-vos-images>Utiliser des sprites pour concaténer vos images</h3> <p>Les fichiers CSS et JavaScript ne sont pas les seuls à pouvoir êtres combinés pour réduire le nombre de requêtes. Utilisés généralement pour des icones ou de petites illustrations, la technique des sprites CSS est une bonne solution.</p> <p>Essayez de regrouper des images partageant la même palette de couleur. Si ce n’est pas le cas la taille de votre fichier sera anormalement élevée car il sera sauvegardé au format PNG <code>true color</code> au lieu du classique PNG 256 couleurs. Pour éviter une requête avec des images de petite taille, vous pouvez aussi encoder le résultat obtenu en base64 pour optimiser encore plus la taille de votre fichier (à prendre avec précaution car cela peut augementer la taille jusqu'à 37%).</p> <ul> <li><a href="http://www.base64-image.de/">base64</a> pour encoder vos images</li> <li>Un outil CSS : <a href="http://spriteme.org/">SpriteMe</a></li> </ul> <h3 id=viter-le-calcul-navigateur-aka-browser-reflow>Éviter le calcul navigateur aka browser reflow</h3> <p>Une fonctionnalité peu connue des développeurs en terme de performance est la construction d’une page web dans une fenêtre de navigateur. Des problèmes de performance apparaissent dès que l’on essaye de trop modifier dynamiquement la mise en page. Cela force le navigateur à recalculer la place des objets tout en chargeant la page, ce qui ralenti le rendu de la page.</p> <p><img alt="CSS image reflow" src="https://farm6.staticflickr.com/5524/14234276822_25ce57d1cd_o.gif"/></p> <p>La chose la plus importante pour limiter le nombre de "reflow" est de limiter la taille du DOM et le nombre de sélecteurs CSS le plus possible. Moins le DOM contient d'éléments, moins d’objets doivent êtres calculés et positionnés pendant la construction de la page et plus elle se chargera vite. Je ne le répéterai jamais assez :</p> <blockquote> <p>JavaScript est pour le comportement, CSS pour le style.</p> </blockquote> <p>C’est pourquoi vous ne devez <strong>JAMAIS</strong> modifier vos éléments avec du JavaScript.</p> <div class="alert-box alert"> <i class="fa fa-thumbs-o-down"></i> Mauvaise solution </div> <pre class="highlight javascript"><code>    <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'js-box'</span><span class="p">);</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="s2">"#fff"</span><span class="p">;</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="s2">"#000"</span><span class="p">;</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">"#fc0"</span><span class="p">;</span>
</code></pre> <p>Chaque déclaration provoque un calcul. Dans notre cas il y a 3 reflow.</p> <div class="alert-box success"> <i class="fa fa-thumbs-o-up"></i> Bonne solution </div> <pre class="highlight javascript"><code>    <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'js-box'</span><span class="p">);</span>
    <span class="nx">el</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"m-box"</span><span class="p">;</span>
</code></pre> <p>1 seul reflow. Le style est déclaré à sa place : dans une feuille de style et vous n’aurez pas besoin d’utiliser <code>!important</code> si votre élément change.</p> <p>Les calculs sont aussi impactés par l’ajout d'élements au DOM.</p> <p><img alt="Border image reflow" src="https://farm3.staticflickr.com/2922/14234595522_c68157e017_o.jpg"/> <em>Il y a le bon :hover et le mauvais :hover</em></p> <p>Pour aller plus loin et comprendre le fonctionnement d’un navigateur web je vous invite à regarder l’excellente présentation de <a href="https://www.youtube.com/watch?v=enKJMUArlV4">Paul Rouget développeur chez Mozilla</a>. Ou encore le projet <a href="https://github.com/janjongboom/css-reflow-tracer">css-reflow-tracer</a>.</p> <h3 id=sur-mobile-toucher-est-meilleur-que-cliquer>Sur mobile toucher est meilleur que cliquer</h3> <p>L’impression de rapidité et la performance sont 2 choses différentes.</p> <p>Connaissez-vous le célèbre délai des 300ms implémenté par tous les appareils mobiles ? Ce délai permet aux utilisateurs d’avoir le temps d’effectuer un double-tap. Dans certains cas il n’est pas nécessaire et pour retirer ce délai il existe des solutions :</p> <ul> <li><a href="https://developers.google.com/mobile/articles/fast_buttons">Comment créer des boutons rapides</a> ?</li> <li>Le polyfill <a href="https://github.com/ftlabs/fastclick">Fastclic.js</a></li> </ul> <h3 id=aller--lessentiel-et-supprimer-les-normes-frameworks>Aller à l’essentiel et supprimer les énormes frameworks</h3> <p>JavaScript n’est pas le seul responsable dans l’explosion du poids des pages web, notamment depuis que l’internet se <a href="http://getbootstrap.com">bootstrapize</a>. Le framework bootsrap de twitter est une excellente solution mais utilisez ses composants avec partimonie. Préférez lui une solution plus légère comme Foundation ou encore KNACSS. Vous pouvez aussi envisager de construire votre propre grille avec <a href="http://susy.oddbird.net/">Suzy</a> et créer vos propres composants.</p> <p>Il est facile d’inclure dans votre projet des librairies comme jQuery ou mootools, et d’y ajouter une myriade de plugins. En tant que développeurs nous devons nous poser la question de ce qui est vraiment utile. Si vous utiliser jQuery seulement comme outil de sélection <code>$('element')</code> regardez du coté de <a href="https://github.com/chjj/zest">Zest</a> ou <a href="https://github.com/ded/qwery">qwery</a>. Ces micro framework JavaScript sont spécialement crées pour ça et leur taille est d’environ 11ko comparé à plus de 90ko.</p> <p>Comme expliqué précédemment, quand un navigateur télécharge jQuery, il doit parcourir le fichier. Cela demande du temps et bloque le rendu de la page. Soyez critique quand vous analysez vos besoins en JavaScript. 11ko c’est peut-être 11ko de trop si la seule chose dont vous avez besoin est <code>document.getElementByTagName('foo')</code>.</p> <h2 id=la-performance-comme-budget>La performance comme budget</h2> <p>Généralement la performance ne fait pas l’objet d’un budget pour un projet web. Mais tout comme les créateurs de jeux vidéos qui ont une limite dans le nombre de polygones affichés à l'écran, les développeurs devraient imposer une limite de taille pour alléger le poids des sites internets.</p> <p>Si votre client est résistant à se soucier de la performance, voici une petite astuce qui fonctionne :</p> <ol> <li>Sélectionner deux sites (au hasard le site web du client ainsi qu’un concurrent)</li> <li>préchargez / precachez le site du concurrent en dur dans le cache (avec <code>localStorage</code>)</li> <li>et l’exécuter en comparant le site internet du client non mise en cache.</li> </ol> <p>Personne ne veut attendre et les gens sont impatient, à partir du moment où le client comprendra la différence, il voudra un site web rapide, et investira pour avoir une bonne performance.</p> <p>C’est culotté, mais cette méthode permet de démontrer l’importance de la performance. Je ne pense pas que cette façon de faire soit différente des publicicités télévisées que l’on voit à longeur de journée.</p> <p>Pour aller plus loin, vous pouver créez un graphique comparatif du temps de chargement contre le trafic en temps réel, le client verra la corrélation entre les deux. De nombreuses décisions devront être réexaminées dans le but d’une meilleure performance, je crois que c’est une très, très bonne chose !</p> <div class=row><div class="medium-8 medium-centered columns"><aside class=m-blog-panel itemprop=author itemscope="" itemtype="http://schema.org/Person" role=complementary><p><strong>Publié par <a href="https://plus.google.com/+DavidLeulietteWeb?rel=author" itemprop=name>David Leuliette</a><span itemprop=jobTitle>consultant développeur front-end.</span></strong></p><hr/><div class=row><div class="small-3 columns"><a class=l-avatar href="/about.html"><img itemprop=image alt="Avatar Aperture Science" src="../assets/images/front/aperture-science-avatar-da9be508.jpg"/></a></div><div class="small-9 columns"><p>J’aime travailler avec les technologies web et le faire de la bonne façon. En tant qu’<em itemprop=title>évangéliste open source</em>, je partage mes bonnes pratiques avec le plus grand nombre. </p></div></div><div class=l-footer><a href="https://twitter.com/_flexbox"><i class="fa fa-fw fa-twitter"></i><span itemprop=nickname>@_flexbox </span>sur twitter </a><a href="/feed.xml"><i class="fa fa-fw fa-rss"></i>S’incrire au flux RSS </a></div></aside></div></div></div></article></div><div class=m-footer--section><div class=row><div class="medium-10 medium-centered columns"><nav class=row role=navigation><div class="small-6 medium-3 columns"><ul class=m-footer--side-nav role=menubar><li class=l-title>Outils</li><li role=menuitem><a title="Logiciels pour le développement et l’intégration web" href="/toolkit.html">Applications</a></li><li role=menuitem><a title="Mes projets" href="/projects.html">Open source</a></li><li role=menuitem><a title="Mes engagements envers le web" href="/manifesto.html">Manifeste</a></li><li role=menuitem><a title="Méthode pour le design de sites internet" href="/webdesign.html">Responsive</a></li></ul></div><div class="small-6 medium-3 columns"><ul class=m-footer--side-nav role=menubar><li class=l-title>Ressources</li><li role=menuitem><a title="Publication d'articles sur l'intégration &amp; le développement front-end" href="/blog/">Blog</a></li><li role=menuitem><a title="conseils de lecture" href="/books.html">Bibliothèque</a></li><li role=menuitem><a title="conseils sur la typographie pour le web" href="/typography.html">Typographie</a></li><li role=menuitem><a title="Liste de personnes à suivre" href="/mentors.html">Mentors</a></li></ul></div><div class="small-6 medium-3 columns"><ul class=m-footer--side-nav role=menubar><li class=l-title>À propos</li><li role=menuitem><a title="Je peux vous aider" href="/about.html">En savoir plus</a></li><li role=menuitem><a title="Licence du site &amp; hébergement" href="/legal.html">Mentions légales</a></li><li role=menuitem><a href="/gnu.html">GNU/GPL</a></li><li role=menuitem><a title="Cliquez si vous êtes perdus" href="/sitemap.html">Plan du site</a></li></ul></div><div class="small-6 medium-3 columns"><ul class=m-footer--side-nav role=menubar><li class=l-title>Contact</li><li role=menuitem><a title="Je lis TOUS mes emails" href="/contact.html">Contact</a></li><li role=menuitem><a title="Je réponds chaque semaine à une question" href="/ask-me.html">Une question ?</a></li><li role=menuitem><a title="Vous pouvez m’enbaucher" href="/work.html">Services</a></li><li role=menuitem><a title="Suivre l’évolution de mes services" href="/newsletter.html">Newsletter</a></li></ul></div></nav></div></div></div><footer class=m-footer role=contentinfo><div class=row><div class="medium-8 medium-centered columns"><p class=m-footer--title>Améliorer vos compétences</p><p>Recevez mes conseils en développement front-end. Ne vous inquétez pas je déteste le spam, il suffit d'un clic pour se désabonner.</p><form action="http://davidl.us3.list-manage2.com/subscribe/post?u=b72e60a9116993dde8d1547fe&amp;id=e99fbeb8ad" method=post name=mc-embedded-subscribe-form target=_blank><div class=row><div class="small-12 columns"><label for=js-mailchimpemail>S’abonner pour ne pas manquer les nouvelles publications </label></div></div><div class=row><div class="small-8 columns"><input autocapitalize=none autocorrect=off class=m-mailchimpemail id=js-mailchimpemail name=EMAIL placeholder="youare@weso.me" required="" type=email /><div class=hide><input name=b_b72e60a9116993dde8d1547fe_e99fbeb8ad type=text /></div></div><div class="small-4 columns"><button class="button postfix" id=mc-embedded-subscribe name=subscribe type=submit>S’inscrire </button></div></div></form></div></div><hr/><p class=l-text>Ce site open source est hébergé sur <a href="https://github.com/flexbox/davidl">GitHub</a>. Patches, suggestions et commentaires sont les bienvenus. <br/>davidl.fr est rédigé et administré par <a href="/human.txt">David Leuliette</a>. Dernière mise à jour le <time datetime=2016-03-06>06/03/2016. </time></p></footer><script src="../assets/javascripts/application-fd90a7c9.js"></script><script>!function(e,a,n,t,c,o,s){e.GoogleAnalyticsObject=c,e[c]=e[c]||function(){(e[c].q=e[c].q||[]).push(arguments)},e[c].l=1*new Date,o=a.createElement(n),s=a.getElementsByTagName(n)[0],o.async=1,o.src=t,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-46684635-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");</script></body></html>